# Phase 1: Feature Extraction Quality Visualization

本目录包含 Phase 1 特征提取质量验证的可视化结果。

## 生成日期
2025-11-14

## 概览

Phase 1 可视化专注于验证和展示分子特征提取的质量和统计特性，与 Phase 2 的稳定性分析形成互补。

### 与 Phase 2 的区别
- **Phase 1 Visualize**: 数据质量验证、特征提取流程、结构特征共现关系
- **Phase 2 Visualize**: 稳定性分析、单体vs二聚体对比、PCA/t-SNE降维

## 目录结构

```
phase1/
├── quality_reports/               # 数据质量报告
│   ├── data_filtering_overview.png          # 数据过滤流程概览（堆叠条形图）
│   └── quality_statistics_table.png         # 质量统计表
│
├── feature_cooccurrence/          # 结构特征共现分析
│   ├── {dataset}_cooccurrence_heatmap.png   # 4×4特征共现热力图
│   └── {dataset}_upset_plot.png             # 集合关系图（Upset Plot）
│
├── multi_dataset_comparison/      # 多数据集对比
│   └── all_datasets_radar_chart.png         # 6维雷达图
│
└── label_conversion/              # 标签转换验证
    ├── label_mapping_table.png              # 标签映射表（星号→分钟）
    └── label_distribution_comparison.png    # SIF/SGF分布对比
```

## 图表说明

### 1. 质量报告 (quality_reports/)

#### data_filtering_overview.png
- **类型**: 堆叠条形图
- **内容**: 展示从原始数据到处理后数据的过滤流程
  - 绿色：保留样本数
  - 红色：过滤掉的样本数
  - 右侧标注：保留率百分比
- **关键指标**:
  - 总样本数：1,931 → 932（保留率 48.3%）
  - 过滤原因：双标签缺失（999个样本）

#### quality_statistics_table.png
- **类型**: 统计表格
- **内容**: 每个数据集的详细统计信息
  - 原始样本数 vs 保留样本数
  - 保留率
  - SIF 标签有效率
  - SGF 标签有效率

### 2. 特征共现分析 (feature_cooccurrence/)

#### {dataset}_cooccurrence_heatmap.png
- **类型**: 4×4 热力图
- **内容**: 结构特征之间的共现关系
  - 行/列：单体、二聚体、环化、二硫键
  - 单元格值：同时具有两个特征的样本数量
- **用途**: 发现特征之间的相关性
  - 示例：二聚体通常含有二硫键

#### {dataset}_upset_plot.png
- **类型**: Upset Plot（集合关系图）
- **内容**: 展示最常见的特征组合
  - 横轴：特征组合
  - 纵轴：样本数量
- **用途**: 识别主要的结构特征模式

### 3. 多数据集对比 (multi_dataset_comparison/)

#### all_datasets_radar_chart.png
- **类型**: 6维雷达图
- **内容**: 5个数据集在6个维度上的对比
  - **维度1**: 单体比例 (%)
  - **维度2**: 环化比例 (%)
  - **维度3**: 二硫键比例 (%)
  - **维度4**: 数据保留率 (%)
  - **维度5**: SIF 标签有效率 (%)
  - **维度6**: SGF 标签有效率 (%)
- **用途**: 直观对比不同专利数据集的特征构成差异

**关键发现**:
- **US9624268** 和 **US20140294902A1**: 100% 单体
- **sif_sgf_second**: 63.8% 二聚体，21.7% 含二硫键
- **US9809623B2**: 60% 二聚体，95% 含二硫键
- 所有数据集的环化率接近 100%（符合环肽研究背景）

### 4. 标签转换验证 (label_conversion/)

#### label_mapping_table.png
- **类型**: 映射表格
- **内容**: 展示所有发现的原始标签及其转换后的分钟值
  - 星号系统: `*` → 420 min, `**` → 270 min, ...
  - 数字系统: `1` → 30 min, `2` → 75 min, ...
  - 特殊处理: `*****S` → 30 min（去除 "S" 后缀）
- **用途**: 验证标签转换逻辑正确性

#### label_distribution_comparison.png
- **类型**: 双面直方图
- **内容**: 转换后的 SIF 和 SGF 标签分布
  - 左图：SIF 稳定性分布
  - 右图：SGF 稳定性分布
  - 横轴：稳定性时间（分钟）
  - 纵轴：样本数量
- **用途**: 查看标签分布是否合理

## 数据集统计摘要

| 数据集 | 原始样本 | 保留样本 | 保留率 | 单体率 | 环化率 | 二硫键率 | SIF有效率 | SGF有效率 |
|--------|---------|---------|--------|--------|--------|---------|----------|----------|
| **US20140294902A1** | 5 | 5 | 100.0% | 100.0% | 100.0% | 100.0% | 100.0% | 0.0% |
| **US9624268** | 775 | 130 | 16.8% | 100.0% | 100.0% | 41.5% | 100.0% | 69.2% |
| **US9809623B2** | 80 | 80 | 100.0% | 40.0% | 95.0% | 95.0% | 100.0% | 20.0% |
| **WO2017011820A2** | 174 | 159 | 91.4% | 95.0% | 99.4% | 45.3% | 100.0% | 71.7% |
| **sif_sgf_second** | 897 | 558 | 62.2% | 36.2% | 100.0% | 21.7% | 100.0% | 100.0% |
| **总计** | **1,931** | **932** | **48.3%** | **55.8%** | **99.5%** | **35.2%** | - | - |

## 关键洞察

### 1. 数据过滤效果
- **保留率**: 48.3%（932/1931）
- **过滤原因**: 999 个样本因双标签缺失被过滤
- **最高保留率**: US9809623B2（100%）
- **最低保留率**: US9624268（16.8%）

### 2. 结构特征分布
- **环化率**: 99.5%（几乎所有肽链都是环状结构）
- **单体 vs 二聚体**: 55.8% 单体，44.2% 二聚体
- **二硫键**: 35.2% 的样本含有二硫键

### 3. 数据集异质性
不同专利数据集在结构特征上差异显著：
- **US9624268**: 纯单体数据集
- **sif_sgf_second**: 二聚体为主（63.8%）
- **US9809623B2**: 高二硫键含量（95%）

### 4. 标签有效性
- **SIF 标签**: 整体有效性高（所有保留样本都有 SIF 标签）
- **SGF 标签**: 部分数据集 SGF 标签缺失较多
  - US20140294902A1: 0% SGF 有效
  - sif_sgf_second: 100% SGF 有效

## 生成方法

使用以下命令重新生成可视化：

```bash
uv run python scripts/phase1_visualize.py \
    --raw_dir data/raw/ \
    --processed_dir data/processed/ \
    --output_dir outputs/figures/phase1/ \
    --dpi 300 \
    --format png
```

## 依赖

- Python >= 3.11
- matplotlib >= 3.7.0
- seaborn >= 0.12.0
- pandas >= 2.0.0
- numpy >= 1.24.0
- upsetplot >= 0.9.0

## 相关文档

- [Phase 1 实施报告](../../../docs/dev/Phase1_分子特征提取报告.md)
- [Phase 2 可视化报告](../../../docs/dev/Phase2_数据可视化报告.md)
- [项目进度](../../../docs/dev/项目进度.md)

---

**生成时间**: 2025-11-14
**脚本**: `scripts/phase1_visualize.py`
**图表总数**: 15 张
